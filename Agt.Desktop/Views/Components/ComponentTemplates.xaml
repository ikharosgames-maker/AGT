<?xml version="1.0" encoding="utf-8"?>
<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mdl="clr-namespace:Agt.Desktop.Models"
    xmlns:views="clr-namespace:Agt.Desktop.Views">

    <!-- ====== ZÁKLADNÍ STYLY ====== -->

    <Style x:Key="Field_Label" TargetType="TextBlock">
        <Setter Property="Margin" Value="0,0,0,2"/>
        <Setter Property="FontWeight" Value="SemiBold"/>
        <Setter Property="Foreground" Value="{DynamicResource AppTextBrush}"/>
        <Setter Property="TextWrapping" Value="Wrap"/>
    </Style>

    <!-- hostovací border (volitelný rámeček, default transparent) -->
    <Style x:Key="Field_BackgroundHost" TargetType="Border">
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="BorderBrush" Value="{DynamicResource AppBorderBrush}"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="CornerRadius" Value="2"/>
        <Setter Property="SnapsToDevicePixels" Value="True"/>
    </Style>

    <Style x:Key="Field_InputBase" TargetType="Control">
        <Setter Property="Margin" Value="0"/>
        <Setter Property="Padding" Value="6,2"/>
        <Setter Property="Foreground" Value="{DynamicResource AppTextBrush}"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="HorizontalContentAlignment" Value="Left"/>
        <Setter Property="VerticalContentAlignment" Value="Center"/>
        <Setter Property="SnapsToDevicePixels" Value="True"/>
    </Style>

    <!-- TextBox – barví vnitřek -->
    <Style x:Key="Field_TextBox" TargetType="TextBox" BasedOn="{StaticResource Field_InputBase}">
        <Setter Property="HorizontalAlignment" Value="Stretch"/>
        <Setter Property="VerticalAlignment"   Value="Stretch"/>
        <Setter Property="CaretBrush"          Value="{DynamicResource AppTextBrush}"/>
        <Setter Property="SelectionBrush"      Value="{DynamicResource AppBorderBrush}"/>
        <Setter Property="BorderBrush"         Value="{DynamicResource AppBorderBrush}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="TextBox">
                    <Border x:Name="Bd"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="2"
                            SnapsToDevicePixels="True">
                        <ScrollViewer x:Name="PART_ContentHost"/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter TargetName="Bd" Property="Opacity" Value="0.6"/>
                        </Trigger>
                        <Trigger Property="IsKeyboardFocusWithin" Value="True">
                            <Setter TargetName="Bd" Property="BorderBrush" Value="{DynamicResource AppAccentBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- TextArea = TextBox with multiline -->
    <Style x:Key="Field_TextArea" TargetType="TextBox" BasedOn="{StaticResource Field_TextBox}">
        <Setter Property="AcceptsReturn"               Value="True"/>
        <Setter Property="TextWrapping"                Value="Wrap"/>
        <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
        <Setter Property="VerticalContentAlignment"    Value="Top"/>
        <Setter Property="TextAlignment"               Value="Left"/>
    </Style>

    <!-- ComboBox – čistý template, barví vnitřek -->
    <Style x:Key="Field_ComboBox" TargetType="ComboBox" BasedOn="{StaticResource Field_InputBase}">
        <Setter Property="HorizontalAlignment" Value="Stretch"/>
        <Setter Property="VerticalAlignment"   Value="Stretch"/>
        <Setter Property="IsEditable"          Value="False"/>
        <Setter Property="BorderBrush"         Value="{DynamicResource AppBorderBrush}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ComboBox">
                    <Grid SnapsToDevicePixels="True">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="2"/>
                        <ContentPresenter x:Name="ContentSite"
                                          Margin="6,2,22,2"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Left"
                                          IsHitTestVisible="False"
                                          Content="{TemplateBinding SelectionBoxItem}"
                                          ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                          ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"/>
                        <ToggleButton x:Name="DropDownToggle"
                                      Grid.ZIndex="1"
                                      Focusable="False"
                                      IsChecked="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}"
                                      HorizontalAlignment="Right"
                                      Width="22"
                                      Background="Transparent"
                                      BorderThickness="0">
                            <Path Data="M 0 0 L 4 4 L 8 0 Z"
                                  Stretch="Uniform"
                                  Width="10" Height="6"
                                  HorizontalAlignment="Center" VerticalAlignment="Center"
                                  Fill="{TemplateBinding Foreground}"/>
                        </ToggleButton>
                        <Popup x:Name="PART_Popup"
                               Placement="Bottom"
                               IsOpen="{TemplateBinding IsDropDownOpen}"
                               AllowsTransparency="True"
                               Focusable="False">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="2">
                                <ScrollViewer>
                                    <ItemsPresenter/>
                                </ScrollViewer>
                            </Border>
                        </Popup>
                        <TextBox x:Name="PART_EditableTextBox"
                                 Visibility="Hidden"
                                 Background="{TemplateBinding Background}"
                                 Foreground="{TemplateBinding Foreground}"
                                 BorderThickness="0"
                                 Margin="6,2,22,2"/>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsEditable" Value="True">
                            <Setter TargetName="ContentSite" Property="Visibility" Value="Hidden"/>
                            <Setter TargetName="PART_EditableTextBox" Property="Visibility" Value="Visible"/>
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter TargetName="Bd" Property="Opacity" Value="0.6"/>
                        </Trigger>
                        <Trigger Property="IsKeyboardFocusWithin" Value="True">
                            <Setter TargetName="Bd" Property="BorderBrush" Value="{DynamicResource AppAccentBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- DatePicker – vlastní template, barví vnitřní TextBox -->
    <Style x:Key="Field_DatePicker" TargetType="DatePicker" BasedOn="{StaticResource Field_InputBase}">
        <Setter Property="HorizontalAlignment" Value="Stretch"/>
        <Setter Property="VerticalAlignment"   Value="Stretch"/>
        <Setter Property="SelectedDateFormat"  Value="Short"/>
        <Setter Property="BorderBrush"         Value="{DynamicResource AppBorderBrush}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="DatePicker">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition Width="22"/>
                        </Grid.ColumnDefinitions>

                        <DatePickerTextBox x:Name="PART_TextBox"
                                           Background="{TemplateBinding Background}"
                                           Foreground="{TemplateBinding Foreground}"
                                           BorderBrush="{TemplateBinding BorderBrush}"
                                           BorderThickness="1"
                                           Padding="6,2"
                                           HorizontalContentAlignment="Stretch"
                                           VerticalContentAlignment="Center"/>

                        <Button Grid.Column="1"
                                x:Name="PART_Button"
                                Focusable="False"
                                Padding="0"
                                BorderThickness="0"
                                Background="Transparent"
                                ToolTip="Kalendář">
                            <Path Data="M 1 3 H 15 V 15 H 1 Z M 1 6 H 15"
                                  Stroke="{TemplateBinding Foreground}"
                                  StrokeThickness="1.2"
                                  Fill="Transparent"/>
                        </Button>

                        <Popup x:Name="PART_Popup"
                               PlacementTarget="{Binding ElementName=PART_Button}"
                               Placement="Bottom"
                               StaysOpen="False"
                               IsOpen="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}}">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="2">
                                <Calendar SelectedDate="{Binding SelectedDate, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}"/>
                            </Border>
                        </Popup>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- CheckBox – jasný mini template -->
    <Style x:Key="Field_CheckBox" TargetType="CheckBox" BasedOn="{StaticResource Field_InputBase}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="CheckBox">
                    <!-- přidané odsazení od levého okraje -->
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="4,0,0,0">
                        <Grid Width="16" Height="16" Margin="0,0,6,0">
                            <Border x:Name="Box"
                                CornerRadius="2"
                                BorderThickness="1"
                                BorderBrush="{TemplateBinding Foreground}"
                                Background="{TemplateBinding Background}"/>
                            <Path x:Name="Tick"
                              Data="M 3 9 L 7 13 L 13 3"
                              Stroke="{TemplateBinding Foreground}"
                              StrokeThickness="2"
                              StrokeLineJoin="Round"
                              StrokeStartLineCap="Round"
                              StrokeEndLineCap="Round"
                              Visibility="Collapsed"/>
                        </Grid>
                        <ContentPresenter VerticalAlignment="Center"
                                      RecognizesAccessKey="True"
                                      ContentSource="Content"/>
                    </StackPanel>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsChecked" Value="True">
                            <Setter TargetName="Tick" Property="Visibility" Value="Visible"/>
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter TargetName="Box" Property="Opacity" Value="0.6"/>
                            <Setter TargetName="Tick" Property="Opacity" Value="0.6"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ====== DATATEMPLATES ====== -->

    <!-- Label -->
    <DataTemplate DataType="{x:Type mdl:LabelField}">
        <Grid Width="{Binding Width}" Height="{Binding Height}">
            <TextBlock Text="{Binding Label}"
                       Foreground="{Binding Foreground}"
                       Background="{Binding Background}"
                       FontFamily="{Binding FontFamily}"
                       FontSize="{Binding FontSize}"
                       VerticalAlignment="Center"
                       Padding="6,2"/>
        </Grid>
    </DataTemplate>

    <!-- TextBox (1-řádkový) -->
    <DataTemplate DataType="{x:Type mdl:TextBoxField}">
        <Grid Width="{Binding Width}" Height="{Binding Height}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" Style="{StaticResource Field_Label}"
                       Text="{Binding Label}"
                       Foreground="{Binding Foreground}"/>

            <Grid Grid.Row="1">
                <Border Style="{StaticResource Field_BackgroundHost}"/>
                <TextBox Panel.ZIndex="1"
                         Background="{Binding Background}"
                         Foreground="{Binding Foreground}"
                         FontFamily="{Binding FontFamily}"
                         FontSize="{Binding FontSize}"
                         Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <TextBox.Style>
                        <Style TargetType="TextBox" BasedOn="{StaticResource Field_TextBox}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ItemsControl},
                                                               Path=(views:RenderModeHelper.Mode)}"
                                             Value="{x:Static mdl:RenderMode.ReadOnly}">
                                    <Setter Property="IsReadOnly" Value="True"/>
                                    <Setter Property="IsHitTestVisible" Value="False"/>
                                    <Setter Property="Focusable" Value="False"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>
            </Grid>
        </Grid>
    </DataTemplate>

    <!-- TextArea -->
    <DataTemplate DataType="{x:Type mdl:TextAreaField}">
        <Grid Width="{Binding Width}" Height="{Binding Height}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" Style="{StaticResource Field_Label}"
                       Text="{Binding Label}"
                       Foreground="{Binding Foreground}"/>

            <Grid Grid.Row="1">
                <Border Style="{StaticResource Field_BackgroundHost}"/>
                <TextBox Panel.ZIndex="1"
                         Background="{Binding Background}"
                         Foreground="{Binding Foreground}"
                         FontFamily="{Binding FontFamily}"
                         FontSize="{Binding FontSize}"
                         Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <TextBox.Style>
                        <Style TargetType="TextBox" BasedOn="{StaticResource Field_TextArea}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ItemsControl},
                                                               Path=(views:RenderModeHelper.Mode)}"
                                             Value="{x:Static mdl:RenderMode.ReadOnly}">
                                    <Setter Property="IsReadOnly" Value="True"/>
                                    <Setter Property="IsHitTestVisible" Value="False"/>
                                    <Setter Property="Focusable" Value="False"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>
            </Grid>
        </Grid>
    </DataTemplate>

    <!-- Number -->
    <DataTemplate DataType="{x:Type mdl:NumberField}">
        <Grid Width="{Binding Width}" Height="{Binding Height}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" Style="{StaticResource Field_Label}"
                       Text="{Binding Label}"
                       Foreground="{Binding Foreground}"/>

            <Grid Grid.Row="1">
                <Border Style="{StaticResource Field_BackgroundHost}"/>
                <TextBox Panel.ZIndex="1"
                         Background="{Binding Background}"
                         Foreground="{Binding Foreground}"
                         FontFamily="{Binding FontFamily}"
                         FontSize="{Binding FontSize}"
                         HorizontalContentAlignment="Right"
                         Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <TextBox.Style>
                        <Style TargetType="TextBox" BasedOn="{StaticResource Field_TextBox}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ItemsControl},
                                                               Path=(views:RenderModeHelper.Mode)}"
                                             Value="{x:Static mdl:RenderMode.ReadOnly}">
                                    <Setter Property="IsReadOnly" Value="True"/>
                                    <Setter Property="IsHitTestVisible" Value="False"/>
                                    <Setter Property="Focusable" Value="False"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>
            </Grid>
        </Grid>
    </DataTemplate>

    <!-- Date -->
    <DataTemplate DataType="{x:Type mdl:DateField}">
        <Grid Width="{Binding Width}" Height="{Binding Height}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" Style="{StaticResource Field_Label}"
                       Text="{Binding Label}"
                       Foreground="{Binding Foreground}"/>

            <Grid Grid.Row="1">
                <Border Style="{StaticResource Field_BackgroundHost}"/>
                <DatePicker Panel.ZIndex="1"
                            Background="{Binding Background}"
                            Foreground="{Binding Foreground}"
                            FontFamily="{Binding FontFamily}"
                            FontSize="{Binding FontSize}"
                            SelectedDate="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <DatePicker.Style>
                        <Style TargetType="DatePicker" BasedOn="{StaticResource Field_DatePicker}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ItemsControl},
                                                               Path=(views:RenderModeHelper.Mode)}"
                                             Value="{x:Static mdl:RenderMode.ReadOnly}">
                                    <Setter Property="IsEnabled" Value="False"/>
                                    <Setter Property="Focusable" Value="False"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DatePicker.Style>
                </DatePicker>
            </Grid>
        </Grid>
    </DataTemplate>

    <!-- ComboBox -->
    <DataTemplate DataType="{x:Type mdl:ComboBoxField}">
        <Grid Width="{Binding Width}" Height="{Binding Height}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" Style="{StaticResource Field_Label}"
                       Text="{Binding Label}"
                       Foreground="{Binding Foreground}"/>

            <Grid Grid.Row="1">
                <Border Style="{StaticResource Field_BackgroundHost}"/>
                <ComboBox Panel.ZIndex="1"
                          Background="{Binding Background}"
                          Foreground="{Binding Foreground}"
                          FontFamily="{Binding FontFamily}"
                          FontSize="{Binding FontSize}"
                          ItemsSource="{Binding Options}"
                          SelectedItem="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          IsEditable="{Binding IsEditable}">
                    <ComboBox.Style>
                        <Style TargetType="ComboBox" BasedOn="{StaticResource Field_ComboBox}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ItemsControl},
                                                               Path=(views:RenderModeHelper.Mode)}"
                                             Value="{x:Static mdl:RenderMode.ReadOnly}">
                                    <Setter Property="IsHitTestVisible" Value="False"/>
                                    <Setter Property="Focusable" Value="False"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ComboBox.Style>
                </ComboBox>
            </Grid>
        </Grid>
    </DataTemplate>

    <!-- CheckBox -->
    <DataTemplate DataType="{x:Type mdl:CheckBoxField}">
        <Grid Width="{Binding Width}" Height="{Binding Height}">
            <Border Style="{StaticResource Field_BackgroundHost}"/>
            <CheckBox Panel.ZIndex="1"
                      Style="{StaticResource Field_CheckBox}"
                      Background="{Binding Background}"
                      Foreground="{Binding Foreground}"
                      FontFamily="{Binding FontFamily}"
                      FontSize="{Binding FontSize}"
                      Content="{Binding Label}"
                      IsChecked="{Binding IsCheckedDefault, Mode=TwoWay}"/>
        </Grid>
    </DataTemplate>

</ResourceDictionary>
