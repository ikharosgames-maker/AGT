<Window x:Class="Agt.Desktop.Views.StageRunWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:Agt.Desktop.Views"
        Title="Běh případu"
        Width="1200" Height="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        Background="{DynamicResource AppBackgroundBrush}"
        Foreground="{DynamicResource AppTextBrush}"
        SnapsToDevicePixels="True"
        UseLayoutRounding="True">

    <!-- DataTemplates pro komponenty -->
    

    <DockPanel>
        <!-- Header -->
        <Border DockPanel.Dock="Top"
                Background="{DynamicResource AppCardBrush}"
                BorderBrush="{DynamicResource AppBorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock x:Name="HeaderTitle" FontSize="16" FontWeight="SemiBold"/>
                    <TextBlock Text=" — " Margin="6,0"/>
                    <TextBlock x:Name="StageInfo" Opacity="0.8"/>
                </StackPanel>

                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button Content="Uložit" Padding="16,6" Margin="0,0,8,0" Click="Save_Click"/>
                    <Button Content="Dokončit" Padding="16,6" Margin="0,0,8,0" Click="CompleteStage_Click"/>
                    <Button Content="Zavřít" Padding="16,6" Click="Close_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Canvas with blocks -->
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Blocks}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <views:AutoSizeCanvas/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemContainerStyle>
                    <Style TargetType="ContentPresenter">
                        <Setter Property="Canvas.Left" Value="{Binding X}"/>
                        <Setter Property="Canvas.Top"  Value="{Binding Y}"/>
                    </Style>
                </ItemsControl.ItemContainerStyle>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border CornerRadius="8"
                                Padding="12"
                                BorderBrush="{DynamicResource AppBorderBrush}"
                                BorderThickness="1"
                                Background="{DynamicResource AppCardBrush}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="{Binding Title}"
                                           FontWeight="SemiBold"
                                           Margin="0,0,0,8"/>

                                <!-- DŮLEŽITÉ: předat Mode i jako attached property -->
                                <views:ComponentViewerControl Grid.Row="1"
                                                              Items="{Binding Components}"
                                                              Mode="{Binding Mode}"
                                                              views:RenderModeHelper.Mode="{Binding Mode}"
                                                              Width="{Binding PreviewWidth}"
                                                              Height="{Binding PreviewHeight}"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </DockPanel>
</Window>
