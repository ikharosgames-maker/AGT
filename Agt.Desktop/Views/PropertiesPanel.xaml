<UserControl x:Class="Agt.Desktop.Views.PropertiesPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:m="clr-namespace:Agt.Desktop.Models"
             xmlns:views="clr-namespace:Agt.Desktop.Views"
             xmlns:comp="clr-namespace:Agt.Desktop.Views.Components"
             xmlns:conv="clr-namespace:Agt.Desktop.Converters">

    <!-- ====== Resources ====== -->
    <UserControl.Resources>
        <!-- převodníky -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        <conv:IntEqualsToVisibilityConverter x:Key="EqVis"/>
        <conv:IntGreaterOrEqualToVisibilityConverter x:Key="GeVis"/>
        <conv:BrushToHexConverter x:Key="BrushToHex"/>
        <conv:BrushToHexThemeFallbackConverter x:Key="BrushToHexThemeFallback"/>

        <!-- selector pro typové šablony z ComponentTemplates.xaml (Props.*) -->
        <comp:ComponentPropertyTemplateSelector x:Key="ComponentPropertyTemplateSelector"/>

        <!-- ROOT: jediná šablona pro 1 vybranou položku -->
        <DataTemplate x:Key="Props.Root">
            <StackPanel>
                <TextBlock Text="Vlastnosti" FontWeight="SemiBold" Margin="0,0,0,8"/>

                <!-- Obecné vlastnosti -->
                <UniformGrid Columns="2" Margin="0,0,0,12">
                    <TextBlock Text="Název prvku"/>
                    <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Klíč pole"/>
                    <TextBox Text="{Binding FieldKey, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Typ"/>
                    <TextBlock Text="{Binding TypeKey}"/>

                    <TextBlock Text="Popisek (Label)"/>
                    <TextBox Text="{Binding Label, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Placeholder"/>
                    <TextBox Text="{Binding Placeholder, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Povinné"/>
                    <CheckBox IsChecked="{Binding Required, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Výchozí hodnota"/>
                    <TextBox Text="{Binding DefaultValue, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Písmo (FontFamily)"/>
                    <TextBox Text="{Binding FontFamily, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Velikost písma"/>
                    <TextBox Text="{Binding FontSize, UpdateSourceTrigger=PropertyChanged}"/>

                    <!-- Zarovnání -->
                    <TextBlock Text="Zarovnání labelu"/>
                    <ComboBox SelectedValue="{Binding LabelHorizontalAlignment}"
                              SelectedValuePath="Tag">
                        <ComboBoxItem Content="Vlevo" Tag="Left"/>
                        <ComboBoxItem Content="Na střed" Tag="Center"/>
                        <ComboBoxItem Content="Vpravo" Tag="Right"/>
                    </ComboBox>

                    <TextBlock Text="Zarovnání textu"/>
                    <ComboBox SelectedValue="{Binding TextAlignment}"
                              SelectedValuePath="Tag">
                        <ComboBoxItem Content="Vlevo" Tag="Left"/>
                        <ComboBoxItem Content="Na střed" Tag="Center"/>
                        <ComboBoxItem Content="Vpravo" Tag="Right"/>
                    </ComboBox>

                    <!-- Styl písma labelu -->
                    <TextBlock Text="Label tučné"/>
                    <CheckBox IsChecked="{Binding LabelBold, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Label kurzíva"/>
                    <CheckBox IsChecked="{Binding LabelItalic, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Label podtržený"/>
                    <CheckBox IsChecked="{Binding LabelUnderline, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Label přeškrtnutý"/>
                    <CheckBox IsChecked="{Binding LabelStrikeThrough, UpdateSourceTrigger=PropertyChanged}"/>

                    <!-- Styl písma obsahu -->
                    <TextBlock Text="Text tučné"/>
                    <CheckBox IsChecked="{Binding FontBold, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Text kurzíva"/>
                    <CheckBox IsChecked="{Binding FontItalic, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Text podtržený"/>
                    <CheckBox IsChecked="{Binding FontUnderline, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Text přeškrtnutý"/>
                    <CheckBox IsChecked="{Binding FontStrikeThrough, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="X"/>
                    <TextBox Text="{Binding X, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Y"/>
                    <TextBox Text="{Binding Y, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Šířka"/>
                    <TextBox Text="{Binding Width, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Výška"/>
                    <TextBox Text="{Binding Height, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Z-index"/>
                    <TextBox Text="{Binding ZIndex, UpdateSourceTrigger=PropertyChanged}"/>
                </UniformGrid>

                <!-- Barvy (s color pickery) -->
                <TextBlock Text="Barvy" FontWeight="SemiBold" Margin="6,6,0,6"/>
                <UniformGrid Columns="2" Margin="0,0,0,8">
                    <!-- Barva textu (obsah) -->
                    <TextBlock Text="Barva textu"/>
                    <DockPanel LastChildFill="True">
                        <Button Width="20" Height="20" Margin="0,0,6,0" DockPanel.Dock="Left"
                                BorderBrush="#666" BorderThickness="1"
                                Background="{Binding Foreground, TargetNullValue={StaticResource AppTextBrush}}"
                                ToolTip="Změnit barvu"
                                Click="PickForeground_Click"/>
                        <TextBox Text="{Binding Foreground,
                                                Converter={StaticResource BrushToHexThemeFallback},
                                                ConverterParameter=AppTextBrush,
                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </DockPanel>

                    <!-- Barva pozadí (obsah) -->
                    <TextBlock Text="Barva pozadí"/>
                    <DockPanel LastChildFill="True">
                        <Button Width="20" Height="20" Margin="0,0,6,0" DockPanel.Dock="Left"
                                BorderBrush="#666" BorderThickness="1"
                                Background="{Binding Background, TargetNullValue={StaticResource AppBackgroundBrush}}"
                                ToolTip="Změnit barvu"
                                Click="PickBackground_Click"/>
                        <TextBox Text="{Binding Background,
                                                Converter={StaticResource BrushToHexThemeFallback},
                                                ConverterParameter=AppBackgroundBrush,
                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </DockPanel>

                    <!-- Barvy labelu -->
                    <TextBlock Text="Barva textu labelu"/>
                    <DockPanel LastChildFill="True">
                        <Button Width="20" Height="20" Margin="0,0,6,0" DockPanel.Dock="Left"
                                BorderBrush="#666" BorderThickness="1"
                                Background="{Binding LabelForeground, TargetNullValue={StaticResource AppTextBrush}}"
                                ToolTip="Změnit barvu"
                                Click="PickLabelForeground_Click"/>
                        <TextBox Text="{Binding LabelForeground,
                                                Converter={StaticResource BrushToHexThemeFallback},
                                                ConverterParameter=AppTextBrush,
                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </DockPanel>

                    <TextBlock Text="Barva pozadí labelu"/>
                    <DockPanel LastChildFill="True">
                        <Button Width="20" Height="20" Margin="0,0,6,0" DockPanel.Dock="Left"
                                BorderBrush="#666" BorderThickness="1"
                                Background="{Binding LabelBackground, TargetNullValue={StaticResource AppBackgroundBrush}}"
                                ToolTip="Změnit barvu"
                                Click="PickLabelBackground_Click"/>
                        <TextBox Text="{Binding LabelBackground,
                                                Converter={StaticResource BrushToHexThemeFallback},
                                                ConverterParameter=AppBackgroundBrush,
                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </DockPanel>
                </UniformGrid>

                <!-- Ukotvení / Dock -->
                <TextBlock Text="Ukotvení / Dock" FontWeight="SemiBold" Margin="6,6,0,6"/>
                <views:AnchorDockEditor Anchor="{Binding Anchor, Mode=TwoWay}"
                                        Dock="{Binding Dock, Mode=TwoWay}"/>

                <!-- Datové vazby (uživatelský JSON pro DbAgent) -->
                <TextBlock Text="Datové vazby (JSON)" FontWeight="SemiBold" Margin="6,6,0,6"/>
                <DockPanel LastChildFill="True">
                    <TextBox AcceptsReturn="True"
                             VerticalScrollBarVisibility="Auto"
                             MinLines="6"
                             FontFamily="Consolas"
                             FontSize="12">
                        <TextBox.Text>
                            <PriorityBinding>
                                <Binding Path="DataBindingJson"
                                         Mode="TwoWay"
                                         UpdateSourceTrigger="PropertyChanged"/>
                                <Binding Path="DataBinding"
                                         Mode="TwoWay"
                                         UpdateSourceTrigger="PropertyChanged"/>
                            </PriorityBinding>
                        </TextBox.Text>
                    </TextBox>
                </DockPanel>
            </StackPanel>
        </DataTemplate>
    </UserControl.Resources>

    <!-- ====== Layout ====== -->
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="10">

            <!-- Nic vybráno -->
            <StackPanel Visibility="{Binding SelectedCount,
                                             Converter={StaticResource EqVis},
                                             ConverterParameter=0}">
                <TextBlock Text="Nic není vybráno" FontWeight="SemiBold" Margin="0,0,0,8"/>
                <TextBlock Text="Tip: Ctrl-klik přidá/odebere položku výběru. Táhni myší pro lasso výběr."/>
            </StackPanel>

            <!-- Jedna položka -->
            <ContentControl Visibility="{Binding SelectedCount,
                                                 Converter={StaticResource EqVis},
                                                 ConverterParameter=1}"
                            Content="{Binding SelectedItem}"
                            ContentTemplate="{StaticResource Props.Root}"/>

            <!-- Více položek -->
            <StackPanel Visibility="{Binding SelectedCount,
                                             Converter={StaticResource GeVis},
                                             ConverterParameter=2}">
                <TextBlock Text="Hromadná úprava" FontWeight="SemiBold" Margin="0,10,0,8"/>
                <TextBlock Text="{Binding SelectedCount, StringFormat='Vybráno {0} položek.'}" Margin="0,0,0,8"/>

                <UniformGrid Columns="2" Margin="0,0,0,8">
                    <TextBlock Text="Název prvku"/>
                    <TextBox Text="{Binding BulkName, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Popisek (Label)"/>
                    <TextBox Text="{Binding BulkLabel, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Klíč pole"/>
                    <TextBox Text="{Binding BulkFieldKey, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Písmo (FontFamily)"/>
                    <TextBox Text="{Binding BulkFontFamily, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Velikost písma"/>
                    <TextBox Text="{Binding BulkFontSize, UpdateSourceTrigger=PropertyChanged}"/>

                    <!-- Barvy textu a pozadí obsahu -->
                    <TextBlock Text="Barva textu"/>
                    <DockPanel LastChildFill="True">
                        <Button Width="20" Height="20" Margin="0,0,6,0" DockPanel.Dock="Left"
                                BorderBrush="#666" BorderThickness="1"
                                Background="{Binding BulkForeground, TargetNullValue={StaticResource AppTextBrush}}"
                                ToolTip="Změnit barvu"
                                Click="PickBulkForeground_Click"/>
                        <TextBox Text="{Binding BulkForeground,
                                                Converter={StaticResource BrushToHexThemeFallback},
                                                ConverterParameter=AppTextBrush,
                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </DockPanel>

                    <TextBlock Text="Barva pozadí"/>
                    <DockPanel LastChildFill="True">
                        <Button Width="20" Height="20" Margin="0,0,6,0" DockPanel.Dock="Left"
                                BorderBrush="#666" BorderThickness="1"
                                Background="{Binding BulkBackground, TargetNullValue={StaticResource AppBackgroundBrush}}"
                                ToolTip="Změnit barvu"
                                Click="PickBulkBackground_Click"/>
                        <TextBox Text="{Binding BulkBackground,
                                                Converter={StaticResource BrushToHexThemeFallback},
                                                ConverterParameter=AppBackgroundBrush,
                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </DockPanel>

                    <!-- Barvy labelu (bulk) -->
                    <TextBlock Text="Barva textu labelu"/>
                    <DockPanel LastChildFill="True">
                        <Button Width="20" Height="20" Margin="0,0,6,0" DockPanel.Dock="Left"
                                BorderBrush="#666" BorderThickness="1"
                                Background="{Binding BulkLabelForeground, TargetNullValue={StaticResource AppTextBrush}}"
                                ToolTip="Změnit barvu"
                                Click="PickBulkLabelForeground_Click"/>
                        <TextBox Text="{Binding BulkLabelForeground,
                                                Converter={StaticResource BrushToHexThemeFallback},
                                                ConverterParameter=AppTextBrush,
                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </DockPanel>

                    <TextBlock Text="Barva pozadí labelu"/>
                    <DockPanel LastChildFill="True">
                        <Button Width="20" Height="20" Margin="0,0,6,0" DockPanel.Dock="Left"
                                BorderBrush="#666" BorderThickness="1"
                                Background="{Binding BulkLabelBackground, TargetNullValue={StaticResource AppBackgroundBrush}}"
                                ToolTip="Změnit barvu"
                                Click="PickBulkLabelBackground_Click"/>
                        <TextBox Text="{Binding BulkLabelBackground,
                                                Converter={StaticResource BrushToHexThemeFallback},
                                                ConverterParameter=AppBackgroundBrush,
                                                Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    </DockPanel>

                    <TextBlock Text="Šířka"/>
                    <TextBox Text="{Binding BulkWidth, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Text="Výška"/>
                    <TextBox Text="{Binding BulkHeight, UpdateSourceTrigger=PropertyChanged}"/>
                </UniformGrid>

                <Button Content="Použít na výběr"
                        HorizontalAlignment="Left"
                        Command="{Binding ApplyBulkCommand}"/>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</UserControl>
